"use strict";function RecordRTC(i,e){if(!i)throw"First parameter is required.";e=new RecordRTCConfiguration(i,e=e||{type:"video"});var t=this;function s(h){h&&(e.initCallback=function(){h(),h=e.initCallback=null});var u=new GetRecorderType(i,e);(f=new u(i,e)).record(),b("recording"),e.disableLogs||console.log("Initialized recorderType:",f.constructor.name,"for output-type:",e.type)}function n(h){if(h=h||function(){},f){if("paused"===t.state)return t.resumeRecording(),void setTimeout(function(){n(h)},1);"recording"!==t.state&&!e.disableLogs&&console.warn('Recording state should be: "recording", however current state is: ',t.state),e.disableLogs||console.log("Stopped recording "+e.type+" stream."),"gif"!==e.type?f.stop(u):(f.stop(),u()),b("stopped")}else m();function u(v){if(f){Object.keys(f).forEach(function(w){"function"!=typeof f[w]&&(t[w]=f[w])});var o=f.blob;if(!o){if(!v)throw"Recording failed.";f.blob=o=v}if(o&&!e.disableLogs&&console.log(o.type,"->",bytesToSize(o.size)),h){var d;try{d=URL.createObjectURL(o)}catch{}"function"==typeof h.call?h.call(t,d):h(d)}e.autoWriteToDisk&&R(function(w){var y={};y[e.type+"Blob"]=w,DiskStorage.Store(y)})}else"function"==typeof h.call?h.call(t,""):h("")}}function p(h){postMessage((new FileReaderSync).readAsDataURL(h))}function R(h,u){if(!h)throw"Pass a callback function over getDataURL.";var v=u?u.blob:(f||{}).blob;if(!v)return e.disableLogs||console.warn("Blob encoder did not finish its job yet."),void setTimeout(function(){R(h,u)},1e3);if(typeof Worker<"u"&&!navigator.mozGetUserMedia){var o=function w(y){try{var k=URL.createObjectURL(new Blob([y.toString(),"this.onmessage =  function (eee) {"+y.name+"(eee.data);}"],{type:"application/javascript"})),T=new Worker(k);return URL.revokeObjectURL(k),T}catch{}}(p);o.onmessage=function(y){h(y.data)},o.postMessage(v)}else{var d=new FileReader;d.readAsDataURL(v),d.onload=function(y){h(y.target.result)}}}function l(h){if(h=h||0,"paused"!==t.state){if("stopped"!==t.state){if(h>=t.recordingDuration)return void n(t.onRecordingStopped);h+=1e3,setTimeout(function(){l(h)},1e3)}}else setTimeout(function(){l(h)},1e3)}function b(h){t&&(t.state=h,"function"==typeof t.onStateChanged.call?t.onStateChanged.call(t,h):t.onStateChanged(h))}var g='It seems that recorder is destroyed or "startRecording" is not invoked for '+e.type+" recorder.";function m(){!0!==e.disableLogs&&console.warn(g)}var f,S={startRecording:function a(h){return e.disableLogs||console.log("RecordRTC version: ",t.version),h&&(e=new RecordRTCConfiguration(i,h)),e.disableLogs||console.log("started recording "+e.type+" stream."),f?(f.clearRecordedData(),f.record(),b("recording"),t.recordingDuration&&l(),t):(s(function(){t.recordingDuration&&l()}),t)},stopRecording:n,pauseRecording:function c(){f?"recording"===t.state?(b("paused"),f.pause(),e.disableLogs||console.log("Paused recording.")):e.disableLogs||console.warn("Unable to pause the recording. Recording state: ",t.state):m()},resumeRecording:function r(){f?"paused"===t.state?(b("recording"),f.resume(),e.disableLogs||console.log("Resumed recording.")):e.disableLogs||console.warn("Unable to resume the recording. Recording state: ",t.state):m()},initRecorder:s,setRecordingDuration:function(h,u){if(typeof h>"u")throw"recordingDuration is required.";if("number"!=typeof h)throw"recordingDuration must be a number.";return t.recordingDuration=h,t.onRecordingStopped=u||function(){},{onRecordingStopped:function(v){t.onRecordingStopped=v}}},clearRecordedData:function(){f?(f.clearRecordedData(),e.disableLogs||console.log("Cleared old recorded data.")):m()},getBlob:function(){if(f)return f.blob;m()},getDataURL:R,toURL:function(){if(f)return URL.createObjectURL(f.blob);m()},getInternalRecorder:function(){return f},save:function(h){f?invokeSaveAsDialog(f.blob,h):m()},getFromDisk:function(h){f?RecordRTC.getFromDisk(e.type,h):m()},setAdvertisementArray:function(h){e.advertisement=[];for(var u=h.length,v=0;v<u;v++)e.advertisement.push({duration:v,image:h[v]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){"recording"===t.state&&!e.disableLogs&&console.warn("Stop an active recorder."),f&&"function"==typeof f.clearRecordedData&&f.clearRecordedData(),f=null,b("inactive"),t.blob=null},onStateChanged:function(h){e.disableLogs||console.log("Recorder state changed:",h)},state:"inactive",getState:function(){return t.state},destroy:function(){var h=e.disableLogs;e={disableLogs:!0},t.reset(),b("destroyed"),S=t=null,Storage.AudioContextConstructor&&(Storage.AudioContextConstructor.close(),Storage.AudioContextConstructor=null),e.disableLogs=h,e.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.6.2"};if(!this)return t=S,S;for(var C in S)this[C]=S[C];return t=this,S}function RecordRTCConfiguration(i,e){return!e.recorderType&&!e.type&&(e.audio&&e.video?e.type="video":e.audio&&!e.video&&(e.type="audio")),e.recorderType&&!e.type&&(e.recorderType===WhammyRecorder||e.recorderType===CanvasRecorder||typeof WebAssemblyRecorder<"u"&&e.recorderType===WebAssemblyRecorder?e.type="video":e.recorderType===GifRecorder?e.type="gif":e.recorderType===StereoAudioRecorder?e.type="audio":e.recorderType===MediaStreamRecorder&&(getTracks(i,"audio").length&&getTracks(i,"video").length||!getTracks(i,"audio").length&&getTracks(i,"video").length?e.type="video":getTracks(i,"audio").length&&!getTracks(i,"video").length&&(e.type="audio"))),typeof MediaStreamRecorder<"u"&&typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(e.mimeType||(e.mimeType="video/webm"),e.type||(e.type=e.mimeType.split("/")[0])),e.type||(e.mimeType&&(e.type=e.mimeType.split("/")[0]),e.type||(e.type="audio")),e}function GetRecorderType(i,e){var t;return(isChrome||isEdge||isOpera)&&(t=StereoAudioRecorder),typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&!isChrome&&(t=MediaStreamRecorder),"video"===e.type&&(isChrome||isOpera)&&(t=WhammyRecorder,typeof WebAssemblyRecorder<"u"&&typeof ReadableStream<"u"&&(t=WebAssemblyRecorder)),"gif"===e.type&&(t=GifRecorder),"canvas"===e.type&&(t=CanvasRecorder),isMediaRecorderCompatible()&&t!==CanvasRecorder&&t!==GifRecorder&&typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(getTracks(i,"video").length||getTracks(i,"audio").length)&&("audio"===e.type?"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(t=MediaStreamRecorder):"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(t=MediaStreamRecorder)),i instanceof Array&&i.length&&(t=MultiStreamRecorder),e.recorderType&&(t=e.recorderType),!e.disableLogs&&t&&t.name&&console.log("Using recorderType:",t.name||t.constructor.name),!t&&isSafari&&(t=MediaStreamRecorder),t}function MRecordRTC(i){this.addStream=function(e){e&&(i=e)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var t,e=this.mediaType,a=this.mimeType||{audio:null,video:null,gif:null};if("function"!=typeof e.audio&&isMediaRecorderCompatible()&&!getTracks(i,"audio").length&&(e.audio=!1),"function"!=typeof e.video&&isMediaRecorderCompatible()&&!getTracks(i,"video").length&&(e.video=!1),"function"!=typeof e.gif&&isMediaRecorderCompatible()&&!getTracks(i,"video").length&&(e.gif=!1),!e.audio&&!e.video&&!e.gif)throw"MediaStream must have either audio or video tracks.";if(e.audio&&(t=null,"function"==typeof e.audio&&(t=e.audio),this.audioRecorder=new RecordRTC(i,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:t,mimeType:a.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),e.video||this.audioRecorder.startRecording()),e.video){t=null,"function"==typeof e.video&&(t=e.video);var s=i;if(isMediaRecorderCompatible()&&e.audio&&"function"==typeof e.audio){var n=getTracks(i,"video")[0];isFirefox?((s=new MediaStream).addTrack(n),t&&t===WhammyRecorder&&(t=MediaStreamRecorder)):(s=new MediaStream).addTrack(n)}this.videoRecorder=new RecordRTC(s,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:t,mimeType:a.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),e.audio||this.videoRecorder.startRecording()}if(e.audio&&e.video){var c=this,r=!0===isMediaRecorderCompatible();(e.audio instanceof StereoAudioRecorder&&e.video||!0!==e.audio&&!0!==e.video&&e.audio!==e.video)&&(r=!1),!0===r?(c.audioRecorder=null,c.videoRecorder.startRecording()):c.videoRecorder.initRecorder(function(){c.audioRecorder.initRecorder(function(){c.videoRecorder.startRecording(),c.audioRecorder.startRecording()})})}e.gif&&(t=null,"function"==typeof e.gif&&(t=e.gif),this.gifRecorder=new RecordRTC(i,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:t,mimeType:a.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(e){e=e||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(t){e(t,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(t){e(t,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(t){e(t,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(e){function t(s,n){if(typeof Worker<"u"){var c=function a(s){var r,n=URL.createObjectURL(new Blob([s.toString(),"this.onmessage =  function (eee) {"+s.name+"(eee.data);}"],{type:"application/javascript"})),c=new Worker(n);if(typeof URL<"u")r=URL;else{if(!(typeof webkitURL<"u"))throw"Neither URL nor webkitURL detected.";r=webkitURL}return r.revokeObjectURL(n),c}(function(R){postMessage((new FileReaderSync).readAsDataURL(R))});c.onmessage=function(p){n(p.data)},c.postMessage(s)}else{var r=new FileReader;r.readAsDataURL(s),r.onload=function(p){n(p.target.result)}}}this.getBlob(function(s){s.audio&&s.video?t(s.audio,function(n){t(s.video,function(c){e({audio:n,video:c})})}):s.audio?t(s.audio,function(n){e({audio:n})}):s.video&&t(s.video,function(n){e({video:n})})})},this.writeToDisk=function(){RecordRTC.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){(e=e||{audio:!0,video:!0,gif:!0}).audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof e.audio?e.audio:""),e.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof e.video?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof e.gif?e.gif:"")}}RecordRTC.version="5.6.2",typeof module<"u"&&(module.exports=RecordRTC),"function"==typeof define&&define.amd&&define("RecordRTC",[],function(){return RecordRTC}),RecordRTC.getFromDisk=function(i,e){if(!e)throw"callback is mandatory.";console.log("Getting recorded "+("all"===i?"blobs":i+" blob ")+" from disk!"),DiskStorage.Fetch(function(t,a){"all"!==i&&a===i+"Blob"&&e&&e(t),"all"===i&&e&&e(t,a.replace("Blob",""))})},RecordRTC.writeToDisk=function(i){console.log("Writing recorded blob(s) to disk!"),(i=i||{}).audio&&i.video&&i.gif?i.audio.getDataURL(function(e){i.video.getDataURL(function(t){i.gif.getDataURL(function(a){DiskStorage.Store({audioBlob:e,videoBlob:t,gifBlob:a})})})}):i.audio&&i.video?i.audio.getDataURL(function(e){i.video.getDataURL(function(t){DiskStorage.Store({audioBlob:e,videoBlob:t})})}):i.audio&&i.gif?i.audio.getDataURL(function(e){i.gif.getDataURL(function(t){DiskStorage.Store({audioBlob:e,gifBlob:t})})}):i.video&&i.gif?i.video.getDataURL(function(e){i.gif.getDataURL(function(t){DiskStorage.Store({videoBlob:e,gifBlob:t})})}):i.audio?i.audio.getDataURL(function(e){DiskStorage.Store({audioBlob:e})}):i.video?i.video.getDataURL(function(e){DiskStorage.Store({videoBlob:e})}):i.gif&&i.gif.getDataURL(function(e){DiskStorage.Store({gifBlob:e})})},MRecordRTC.getFromDisk=RecordRTC.getFromDisk,MRecordRTC.writeToDisk=RecordRTC.writeToDisk,typeof RecordRTC<"u"&&(RecordRTC.MRecordRTC=MRecordRTC);var browserFakeUserAgent="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";!function(i){i&&(typeof window<"u"||typeof global>"u"||(global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}},global.console||(global.console={}),(typeof global.console.log>"u"||typeof global.console.error>"u")&&(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),typeof document>"u"&&(i.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return e},i.HTMLVideoElement=function(){}),typeof location>"u"&&(i.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(i.screen={width:0,height:0}),typeof URL>"u"&&(i.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),i.window=global))}(typeof global<"u"?global:null);var requestAnimationFrame=window.requestAnimationFrame;if(typeof requestAnimationFrame>"u")if(typeof webkitRequestAnimationFrame<"u")requestAnimationFrame=webkitRequestAnimationFrame;else if(typeof mozRequestAnimationFrame<"u")requestAnimationFrame=mozRequestAnimationFrame;else if(typeof msRequestAnimationFrame<"u")requestAnimationFrame=msRequestAnimationFrame;else if(typeof requestAnimationFrame>"u"){var lastTime=0;requestAnimationFrame=function(i,e){var t=(new Date).getTime(),a=Math.max(0,16-(t-lastTime)),s=setTimeout(function(){i(t+a)},a);return lastTime=t+a,s}}var cancelAnimationFrame=window.cancelAnimationFrame;typeof cancelAnimationFrame>"u"&&(typeof webkitCancelAnimationFrame<"u"?cancelAnimationFrame=webkitCancelAnimationFrame:typeof mozCancelAnimationFrame<"u"?cancelAnimationFrame=mozCancelAnimationFrame:typeof msCancelAnimationFrame<"u"?cancelAnimationFrame=msCancelAnimationFrame:typeof cancelAnimationFrame>"u"&&(cancelAnimationFrame=function(i){clearTimeout(i)}));var AudioContext=window.AudioContext;typeof AudioContext>"u"&&(typeof webkitAudioContext<"u"&&(AudioContext=webkitAudioContext),typeof mozAudioContext<"u"&&(AudioContext=mozAudioContext));var URL=window.URL;typeof URL>"u"&&typeof webkitURL<"u"&&(URL=webkitURL),typeof navigator<"u"&&typeof navigator.getUserMedia>"u"&&(typeof navigator.webkitGetUserMedia<"u"&&(navigator.getUserMedia=navigator.webkitGetUserMedia),typeof navigator.mozGetUserMedia<"u"&&(navigator.getUserMedia=navigator.mozGetUserMedia));var isEdge=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),isOpera=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(navigator.userAgent),isChrome=!isOpera&&!isEdge&&!!navigator.webkitGetUserMedia||isElectron()||-1!==navigator.userAgent.toLowerCase().indexOf("chrome/"),isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);isSafari&&!isChrome&&-1!==navigator.userAgent.indexOf("CriOS")&&(isSafari=!1,isChrome=!0);var MediaStream=window.MediaStream;function bytesToSize(i){if(0===i)return"0 Bytes";var a=parseInt(Math.floor(Math.log(i)/Math.log(1e3)),10);return(i/Math.pow(1e3,a)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][a]}function invokeSaveAsDialog(i,e){if(!i)throw"Blob object is required.";if(!i.type)try{i.type="video/webm"}catch{}var t=(i.type||"video/webm").split("/")[1];if(-1!==t.indexOf(";")&&(t=t.split(";")[0]),e&&-1!==e.indexOf(".")){var a=e.split(".");e=a[0],t=a[1]}var s=(e||Math.round(9999999999*Math.random())+888888888)+"."+t;if(typeof navigator.msSaveOrOpenBlob<"u")return navigator.msSaveOrOpenBlob(i,s);if(typeof navigator.msSaveBlob<"u")return navigator.msSaveBlob(i,s);var n=document.createElement("a");n.href=URL.createObjectURL(i),n.download=s,n.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(n),"function"==typeof n.click?n.click():(n.target="_blank",n.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),URL.revokeObjectURL(n.href)}function isElectron(){return!!(typeof window<"u"&&"object"==typeof window.process&&"renderer"===window.process.type||typeof process<"u"&&"object"==typeof process.versions&&process.versions.electron||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0)}function getTracks(i,e){return i&&i.getTracks?i.getTracks().filter(function(t){return t.kind===(e||"audio")}):[]}function setSrcObject(i,e){"srcObject"in e?e.srcObject=i:"mozSrcObject"in e?e.mozSrcObject=i:e.srcObject=i}function getSeekableBlob(i,e){if(typeof EBML>"u")throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var t=new EBML.Reader,a=new EBML.Decoder,s=EBML.tools,n=new FileReader;n.onload=function(c){a.decode(this.result).forEach(function(b){t.read(b)}),t.stop();var p=s.makeMetadataSeekable(t.metadatas,t.duration,t.cues),R=this.result.slice(t.metadataSize),l=new Blob([p,R],{type:"video/webm"});e(l)},n.readAsArrayBuffer(i)}typeof MediaStream>"u"&&typeof webkitMediaStream<"u"&&(MediaStream=webkitMediaStream),typeof MediaStream<"u"&&typeof MediaStream.prototype.stop>"u"&&(MediaStream.prototype.stop=function(){this.getTracks().forEach(function(i){i.stop()})}),typeof RecordRTC<"u"&&(RecordRTC.invokeSaveAsDialog=invokeSaveAsDialog,RecordRTC.getTracks=getTracks,RecordRTC.getSeekableBlob=getSeekableBlob,RecordRTC.bytesToSize=bytesToSize,RecordRTC.isElectron=isElectron);var Storage={};function isMediaRecorderCompatible(){if(isFirefox||isSafari||isEdge)return!0;navigator;var n,c,e=navigator.userAgent,t=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10);return(isChrome||isOpera)&&(n=e.indexOf("Chrome"),t=e.substring(n+7)),-1!==(c=t.indexOf(";"))&&(t=t.substring(0,c)),-1!==(c=t.indexOf(" "))&&(t=t.substring(0,c)),a=parseInt(""+t,10),isNaN(a)&&(t=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10)),a>=49}function MediaStreamRecorder(i,e){var t,l=this;if(typeof i>"u")throw'First argument "MediaStream" is required.';if(typeof MediaRecorder>"u")throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";"audio"===(e=e||{mimeType:"video/webm"}).type&&(getTracks(i,"video").length&&getTracks(i,"audio").length&&(navigator.mozGetUserMedia?(t=new MediaStream).addTrack(getTracks(i,"audio")[0]):t=new MediaStream(getTracks(i,"audio")),i=t),(!e.mimeType||-1===e.mimeType.toString().toLowerCase().indexOf("audio"))&&(e.mimeType=isChrome?"audio/webm":"audio/ogg"),e.mimeType&&"audio/ogg"!==e.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(e.mimeType="audio/ogg"));var r,a=[];function s(){l.timestamps.push((new Date).getTime()),"function"==typeof e.onTimeStamp&&e.onTimeStamp(l.timestamps[l.timestamps.length-1],l.timestamps)}function n(b){return r&&r.mimeType?r.mimeType:b.mimeType||"video/webm"}function c(){a=[],r=null,l.timestamps=[]}this.getArrayOfBlobs=function(){return a},this.record=function(){l.blob=null,l.clearRecordedData(),l.timestamps=[],R=[],a=[];var b=e;e.disableLogs||console.log("Passing following config over MediaRecorder API.",b),r&&(r=null),isChrome&&!isMediaRecorderCompatible()&&(b="video/vp8"),"function"==typeof MediaRecorder.isTypeSupported&&b.mimeType&&(MediaRecorder.isTypeSupported(b.mimeType)||(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",b.mimeType),b.mimeType="audio"===e.type?"audio/webm":"video/webm"));try{r=new MediaRecorder(i,b),e.mimeType=b.mimeType}catch{r=new MediaRecorder(i)}b.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in r&&!1===r.canRecordMimeType(b.mimeType)&&(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",b.mimeType)),r.ondataavailable=function(g){if(g.data&&R.push("ondataavailable: "+bytesToSize(g.data.size)),"number"!=typeof e.timeSlice)!g.data||!g.data.size||g.data.size<100||l.blob?l.recordingCallback&&(l.recordingCallback(new Blob([],{type:n(b)})),l.recordingCallback=null):(l.blob=e.getNativeBlob?g.data:new Blob([g.data],{type:n(b)}),l.recordingCallback&&(l.recordingCallback(l.blob),l.recordingCallback=null));else if(g.data&&g.data.size&&(a.push(g.data),s(),"function"==typeof e.ondataavailable)){var m=e.getNativeBlob?g.data:new Blob([g.data],{type:n(b)});e.ondataavailable(m)}},r.onstart=function(){R.push("started")},r.onpause=function(){R.push("paused")},r.onresume=function(){R.push("resumed")},r.onstop=function(){R.push("stopped")},r.onerror=function(g){g&&(g.name||(g.name="UnknownError"),R.push("error: "+g),e.disableLogs||(-1!==g.name.toString().toLowerCase().indexOf("invalidstate")?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",g):-1!==g.name.toString().toLowerCase().indexOf("notsupported")?console.error("MIME type (",b.mimeType,") is not supported.",g):-1!==g.name.toString().toLowerCase().indexOf("security")?console.error("MediaRecorder security error",g):"OutOfMemory"===g.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",g):"IllegalStreamModification"===g.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",g):"OtherRecordingError"===g.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",g):"GenericError"===g.name?console.error("The UA cannot provide the codec or recording option that has been requested.",g):console.error("MediaRecorder Error",g)),function(m){if(!l.manuallyStopped&&r&&"inactive"===r.state)return delete e.timeslice,void r.start(6e5);setTimeout(void 0,1e3)}(),"inactive"!==r.state&&"stopped"!==r.state&&r.stop())},"number"==typeof e.timeSlice?(s(),r.start(e.timeSlice)):r.start(36e5),e.initCallback&&e.initCallback()},this.timestamps=[],this.stop=function(b){b=b||function(){},l.manuallyStopped=!0,r&&(this.recordingCallback=b,"recording"===r.state&&r.stop(),"number"==typeof e.timeSlice&&setTimeout(function(){l.blob=new Blob(a,{type:n(e)}),l.recordingCallback(l.blob)},100))},this.pause=function(){r&&"recording"===r.state&&r.pause()},this.resume=function(){r&&"paused"===r.state&&r.resume()},this.clearRecordedData=function(){r&&"recording"===r.state&&l.stop(c),c()},this.getInternalRecorder=function(){return r},this.blob=null,this.getState=function(){return r&&r.state||"inactive"};var R=[];this.getAllStates=function(){return R},typeof e.checkForInactiveTracks>"u"&&(e.checkForInactiveTracks=!1),l=this,function b(){if(r&&!1!==e.checkForInactiveTracks){if(!1===function p(){if("active"in i){if(!i.active)return!1}else if("ended"in i&&i.ended)return!1;return!0}())return e.disableLogs||console.log("MediaStream seems stopped."),void l.stop();setTimeout(b,1e3)}}(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}function StereoAudioRecorder(i,e){if(!getTracks(i,"audio").length)throw"Your stream has no audio tracks.";var r,t=this,a=[],s=[],n=!1,c=0,p=2,R=(e=e||{}).desiredSampRate;function l(){if(!1===e.checkForInactiveTracks)return!0;if("active"in i){if(!i.active)return!1}else if("ended"in i&&i.ended)return!1;return!0}function b(T,M){function L(A,H){var J,E=A.numberOfAudioChannels,U=A.leftBuffers.slice(0),V=A.rightBuffers.slice(0),P=A.sampleRate,z=A.internalInterleavedLength,F=A.desiredSampRate;function G(x,j,I){var O=Math.round(x.length*(j/I)),B=[],W=Number((x.length-1)/(O-1));B[0]=x[0];for(var q=1;q<O-1;q++){var _=q*W,te=Number(Math.floor(_)).toFixed(),ae=Number(Math.ceil(_)).toFixed();B[q]=Q(x[te],x[ae],_-te)}return B[O-1]=x[x.length-1],B}function Q(x,j,I){return x+(j-x)*I}function X(x,j){for(var I=new Float64Array(j),O=0,B=x.length,W=0;W<B;W++){var q=x[W];I.set(q,O),O+=q.length}return I}function K(x,j,I){for(var O=I.length,B=0;B<O;B++)x.setUint8(j+B,I.charCodeAt(B))}2===E&&(U=X(U,z),V=X(V,z),F&&(U=G(U,F,P),V=G(V,F,P))),1===E&&(U=X(U,z),F&&(U=G(U,F,P))),F&&(P=F),2===E&&(J=function ie(x,j){for(var I=x.length+j.length,O=new Float64Array(I),B=0,W=0;W<I;)O[W++]=x[B],O[W++]=j[B],B++;return O}(U,V)),1===E&&(J=U);var Y=J.length,Z=new ArrayBuffer(44+2*Y),D=new DataView(Z);K(D,0,"RIFF"),D.setUint32(4,36+2*Y,!0),K(D,8,"WAVE"),K(D,12,"fmt "),D.setUint32(16,16,!0),D.setUint16(20,1,!0),D.setUint16(22,E,!0),D.setUint32(24,P,!0),D.setUint32(28,P*E*2,!0),D.setUint16(32,2*E,!0),D.setUint16(34,16,!0),K(D,36,"data"),D.setUint32(40,2*Y,!0);for(var ne=Y,ee=44,$=0;$<ne;$++)D.setInt16(ee,32767*J[$],!0),ee+=2;if(H)return H({buffer:Z,view:D});postMessage({buffer:Z,view:D})}if(T.noWorker)L(T,function(A){M(A.buffer,A.view)});else{var N=function g(T){var M=URL.createObjectURL(new Blob([T.toString(),";this.onmessage =  function (eee) {"+T.name+"(eee.data);}"],{type:"application/javascript"})),L=new Worker(M);return L.workerURL=M,L}(L);N.onmessage=function(A){M(A.data.buffer,A.data.view),URL.revokeObjectURL(N.workerURL),N.terminate()},N.postMessage(T)}}!0===e.leftChannel&&(p=1),1===e.numberOfAudioChannels&&(p=1),(!p||p<1)&&(p=2),e.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+p),typeof e.checkForInactiveTracks>"u"&&(e.checkForInactiveTracks=!0),this.record=function(){if(!1===l())throw"Please make sure MediaStream is active.";v(),d=u=!1,n=!0,typeof e.timeSlice<"u"&&k()},this.stop=function(T){T=T||function(){},n=!1,b({desiredSampRate:R,sampleRate:h,numberOfAudioChannels:p,internalInterleavedLength:c,leftBuffers:a,rightBuffers:1===p?[]:s,noWorker:e.noWorker},function(M,L){t.blob=new Blob([L],{type:"audio/wav"}),t.buffer=new ArrayBuffer(L.buffer.byteLength),t.view=L,t.sampleRate=R||h,t.bufferSize=C,t.length=c,d=!1,T&&T(t.blob)})},typeof RecordRTC.Storage>"u"&&(RecordRTC.Storage={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}),(!RecordRTC.Storage.AudioContextConstructor||"closed"===RecordRTC.Storage.AudioContextConstructor.state)&&(RecordRTC.Storage.AudioContextConstructor=new RecordRTC.Storage.AudioContext);var m=RecordRTC.Storage.AudioContextConstructor,f=m.createMediaStreamSource(i),S=[0,256,512,1024,2048,4096,8192,16384],C=typeof e.bufferSize>"u"?4096:e.bufferSize;if(-1===S.indexOf(C)&&(e.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(S,null,"\t"))),m.createJavaScriptNode)r=m.createJavaScriptNode(C,p,p);else{if(!m.createScriptProcessor)throw"WebAudio API has no support on this browser.";r=m.createScriptProcessor(C,p,p)}f.connect(r),e.bufferSize||(C=r.bufferSize);var h=typeof e.sampleRate<"u"?e.sampleRate:m.sampleRate||44100;(h<22050||h>96e3)&&(e.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),e.disableLogs||e.desiredSampRate&&console.log("Desired sample-rate: "+e.desiredSampRate);var u=!1;function v(){s=[],c=0,d=!1,n=!1,u=!1,m=null,t.leftchannel=a=[],t.rightchannel=s,t.numberOfAudioChannels=p,t.desiredSampRate=R,t.sampleRate=h,t.recordingLength=c,y={left:[],right:[],recordingLength:0}}function o(){r&&(r.onaudioprocess=null,r.disconnect(),r=null),f&&(f.disconnect(),f=null),v()}this.pause=function(){u=!0},this.resume=function(){if(!1===l())throw"Please make sure MediaStream is active.";if(!n)return e.disableLogs||console.log("Seems recording has been restarted."),void this.record();u=!1},this.clearRecordedData=function(){e.checkForInactiveTracks=!1,n&&this.stop(o),o()},this.name="StereoAudioRecorder",this.toString=function(){return this.name};var d=!1;r.onaudioprocess=function w(T){if(!u){if(!1===l()&&(e.disableLogs||console.log("MediaStream seems stopped."),r.disconnect(),n=!1),!n)return void(f&&(f.disconnect(),f=null));d||(d=!0,e.onAudioProcessStarted&&e.onAudioProcessStarted(),e.initCallback&&e.initCallback());var M=T.inputBuffer.getChannelData(0),L=new Float32Array(M);if(a.push(L),2===p){var N=T.inputBuffer.getChannelData(1),A=new Float32Array(N);s.push(A)}t.recordingLength=c+=C,typeof e.timeSlice<"u"&&(y.recordingLength+=C,y.left.push(L),2===p&&y.right.push(A))}},r.connect(m.createMediaStreamDestination?m.createMediaStreamDestination():m.destination),this.leftchannel=a,this.rightchannel=s,this.numberOfAudioChannels=p,this.desiredSampRate=R,this.sampleRate=h,t.recordingLength=c;var y={left:[],right:[],recordingLength:0};function k(){!n||"function"!=typeof e.ondataavailable||typeof e.timeSlice>"u"||(y.left.length?(b({desiredSampRate:R,sampleRate:h,numberOfAudioChannels:p,internalInterleavedLength:y.recordingLength,leftBuffers:y.left,rightBuffers:1===p?[]:y.right},function(T,M){var L=new Blob([M],{type:"audio/wav"});e.ondataavailable(L),setTimeout(k,e.timeSlice)}),y={left:[],right:[],recordingLength:0}):setTimeout(k,e.timeSlice))}}function CanvasRecorder(i,e){if(typeof html2canvas>"u")throw"Please link: https://www.webrtc-experiment.com/screenshot.js";(e=e||{}).frameInterval||(e.frameInterval=10);var t=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(S){S in document.createElement("canvas")&&(t=!0)});var c,r,p,a=!(!window.webkitRTCPeerConnection&&!window.webkitGetUserMedia||!window.chrome),s=50,n=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(a&&n&&n[2]&&(s=parseInt(n[2],10)),a&&s<52&&(t=!1),e.useWhammyRecorder&&(t=!1),t)if(e.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),i instanceof HTMLCanvasElement)c=i;else{if(!(i instanceof CanvasRenderingContext2D))throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";c=i.canvas}else navigator.mozGetUserMedia&&(e.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));this.record=function(){if(p=!0,t&&!e.useWhammyRecorder){var S;"captureStream"in c?S=c.captureStream(25):"mozCaptureStream"in c?S=c.mozCaptureStream(25):"webkitCaptureStream"in c&&(S=c.webkitCaptureStream(25));try{var C=new MediaStream;C.addTrack(getTracks(S,"video")[0]),S=C}catch{}if(!S)throw"captureStream API are NOT available.";(r=new MediaStreamRecorder(S,{mimeType:e.mimeType||"video/webm"})).record()}else f.frames=[],m=(new Date).getTime(),g();e.initCallback&&e.initCallback()},this.getWebPImages=function(S){if("canvas"===i.nodeName.toLowerCase()){var C=f.frames.length;f.frames.forEach(function(h,u){var v=C-u;e.disableLogs||console.log(v+"/"+C+" frames remaining"),e.onEncodingCallback&&e.onEncodingCallback(v,C);var o=h.image.toDataURL("image/webp",1);f.frames[u].image=o}),e.disableLogs||console.log("Generating WebM"),S()}else S()},this.stop=function(S){p=!1;var C=this;t&&r?r.stop(S):this.getWebPImages(function(){f.compile(function(h){e.disableLogs||console.log("Recording finished!"),C.blob=h,C.blob.forEach&&(C.blob=new Blob([],{type:"video/webm"})),S&&S(C.blob),f.frames=[]})})};var R=!1;function l(){f.frames=[],p=!1,R=!1}function b(){var S=document.createElement("canvas"),C=S.getContext("2d");return S.width=i.width,S.height=i.height,C.drawImage(i,0,0),S}function g(){if(R)return m=(new Date).getTime(),setTimeout(g,500);if("canvas"===i.nodeName.toLowerCase()){var S=(new Date).getTime()-m;return m=(new Date).getTime(),f.frames.push({image:b(),duration:S}),void(p&&setTimeout(g,e.frameInterval))}html2canvas(i,{grabMouse:typeof e.showMousePointer>"u"||e.showMousePointer,onrendered:function(C){var h=(new Date).getTime()-m;if(!h)return setTimeout(g,e.frameInterval);m=(new Date).getTime(),f.frames.push({image:C.toDataURL("image/webp",1),duration:h}),p&&setTimeout(g,e.frameInterval)}})}this.pause=function(){R=!0,r instanceof MediaStreamRecorder&&r.pause()},this.resume=function(){R=!1,r instanceof MediaStreamRecorder?r.resume():p||this.record()},this.clearRecordedData=function(){p&&this.stop(l),l()},this.name="CanvasRecorder",this.toString=function(){return this.name};var m=(new Date).getTime(),f=new Whammy.Video(100)}function WhammyRecorder(i,e){function t(m){m=typeof m<"u"?m:10;var f=(new Date).getTime()-b;return f?c?(b=(new Date).getTime(),setTimeout(t,100)):(b=(new Date).getTime(),l.paused&&l.play(),R.drawImage(l,0,0,p.width,p.height),g.frames.push({duration:f,image:p.toDataURL("image/webp")}),void(n||setTimeout(t,m,m))):setTimeout(t,m,m)}(e=e||{}).frameInterval||(e.frameInterval=10),e.disableLogs||console.log("Using frames-interval:",e.frameInterval),this.record=function(){e.width||(e.width=320),e.height||(e.height=240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),p.width=e.canvas.width||320,p.height=e.canvas.height||240,R=p.getContext("2d"),e.video&&e.video instanceof HTMLVideoElement?(l=e.video.cloneNode(),e.initCallback&&e.initCallback()):(l=document.createElement("video"),setSrcObject(i,l),l.onloadedmetadata=function(){e.initCallback&&e.initCallback()},l.width=e.video.width,l.height=e.video.height),l.muted=!0,l.play(),b=(new Date).getTime(),g=new Whammy.Video,e.disableLogs||(console.log("canvas resolutions",p.width,"*",p.height),console.log("video width/height",l.width||p.width,"*",l.height||p.height)),t(e.frameInterval)};var n=!1;this.stop=function(m){m=m||function(){},n=!0;var f=this;setTimeout(function(){!function s(m,f,S,C,h){var u=document.createElement("canvas");u.width=p.width,u.height=p.height;var v=u.getContext("2d"),o=[],d=-1===f,w=f&&f>0&&f<=m.length?f:m.length,k=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),T=S&&S>=0&&S<=1?S:0,M=C&&C>=0&&C<=1?C:0,L=!1;!function a(m){var f=-1,S=m.length;!function C(){++f!==S?setTimeout(function(){m.functionToLoop(C,f)},1):m.callback()}()}({length:w,functionToLoop:function(N,A){var H,E,U,V=function(){!L&&U-H<=U*M||(d&&(L=!0),o.push(m[A])),N()};if(L)V();else{var P=new Image;P.onload=function(){v.drawImage(P,0,0,p.width,p.height);var z=v.getImageData(0,0,p.width,p.height);H=0,E=z.data.length,U=z.data.length/4;for(var F=0;F<E;F+=4){var G={r:z.data[F],g:z.data[F+1],b:z.data[F+2]};Math.sqrt(Math.pow(G.r-0,2)+Math.pow(G.g-0,2)+Math.pow(G.b-0,2))<=k*T&&H++}V()},P.src=m[A].image}},callback:function(){(o=o.concat(m.slice(w))).length<=0&&o.push(m[m.length-1]),h(o)}})}(g.frames,-1,null,null,function(S){g.frames=S,e.advertisement&&e.advertisement.length&&(g.frames=e.advertisement.concat(g.frames)),g.compile(function(C){f.blob=C,f.blob.forEach&&(f.blob=new Blob([],{type:"video/webm"})),m&&m(f.blob)})})},10)};var c=!1;function r(){g.frames=[],n=!0,c=!1}this.pause=function(){c=!0},this.resume=function(){c=!1,n&&this.record()},this.clearRecordedData=function(){n||this.stop(r),r()},this.name="WhammyRecorder",this.toString=function(){return this.name};var l,b,g,p=document.createElement("canvas"),R=p.getContext("2d")}typeof AudioContext<"u"?Storage.AudioContext=AudioContext:typeof webkitAudioContext<"u"&&(Storage.AudioContext=webkitAudioContext),typeof RecordRTC<"u"&&(RecordRTC.Storage=Storage),typeof RecordRTC<"u"&&(RecordRTC.MediaStreamRecorder=MediaStreamRecorder),typeof RecordRTC<"u"&&(RecordRTC.StereoAudioRecorder=StereoAudioRecorder),typeof RecordRTC<"u"&&(RecordRTC.CanvasRecorder=CanvasRecorder),typeof RecordRTC<"u"&&(RecordRTC.WhammyRecorder=WhammyRecorder);var Whammy=function(){function i(a){this.frames=[],this.duration=a||1,this.quality=.8}function t(a){function n(u,v,o){return[{data:u,id:231}].concat(o.map(function(d){var w=function g(u){var v=0;if(u.keyframe&&(v|=128),u.invisible&&(v|=8),u.lacing&&(v|=u.lacing<<1),u.discardable&&(v|=1),u.trackNum>127)throw"TrackNumber > 127 not supported";var o=[128|u.trackNum,u.timecode>>8,255&u.timecode,v].map(function(d){return String.fromCharCode(d)}).join("")+u.frame;return o}({discardable:0,frame:d.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(v)});return v+=d.duration,{data:w,id:163}}))}function r(u){for(var v=[];u>0;)v.push(255&u),u>>=8;return new Uint8Array(v.reverse())}function p(u){return new Uint8Array(u.split("").map(function(v){return v.charCodeAt(0)}))}function R(u){var v=[];u=(u.length%8?new Array(9-u.length%8).join("0"):"")+u;for(var d=0;d<u.length;d+=8)v.push(parseInt(u.substr(d,8),2));return new Uint8Array(v)}function l(u){for(var v=[],o=0;o<u.length;o++){var d=u[o].data;"object"==typeof d&&(d=l(d)),"number"==typeof d&&(d=R(d.toString(2))),"string"==typeof d&&(d=p(d));var w=d.size||d.byteLength||d.length,y=Math.ceil(Math.ceil(Math.log(w)/Math.log(2))/8),k=w.toString(2),T=new Array(7*y+7+1-k.length).join("0")+k,M=new Array(y).join("0")+"1"+T;v.push(r(u[o].id)),v.push(R(M)),v.push(d)}return new Blob(v,{type:"video/webm"})}function f(u,v){return parseInt(u.substr(v+4,4).split("").map(function(o){var d=o.charCodeAt(0).toString(2);return new Array(8-d.length+1).join("0")+d}).join(""),2)}function S(u){for(var v=0,o={};v<u.length;){var d=u.substr(v,4),w=f(u,v),y=u.substr(v+4+4,w);v+=8+w,o[d]=o[d]||[],o[d].push("RIFF"===d||"LIST"===d?S(y):y)}return o}function C(u){return[].slice.call(new Uint8Array(new Float64Array([u]).buffer),0).map(function(v){return String.fromCharCode(v)}).reverse().join("")}var h=new function s(u){var v=function c(u){if(u[0]){for(var v=u[0].width,o=u[0].height,d=u[0].duration,w=1;w<u.length;w++)d+=u[w].duration;return{duration:d,width:v,height:o}}postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."})}(u);if(!v)return[];for(var d=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:C(v.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:v.width,id:176},{data:v.height,id:186}]}]}]}]}],w=0,y=0;w<u.length;){var k=[],T=0;do{k.push(u[w]),T+=u[w].duration,w++}while(w<u.length&&T<3e4);var L={id:524531317,data:n(y,0,k)};d[1].data.push(L),y+=T}return l(d)}(a.map(function(u){var v=function m(u){for(var v=u.RIFF[0].WEBP[0],o=v.indexOf("\x9d\x01*"),d=0,w=[];d<4;d++)w[d]=v.charCodeAt(o+3+d);return{width:16383&(w[1]<<8|w[0]),height:16383&(w[3]<<8|w[2]),data:v,riff:u}}(S(atob(u.image.slice(23))));return v.duration=u.duration,v}));postMessage(h)}return i.prototype.add=function(a,s){if("canvas"in a&&(a=a.canvas),"toDataURL"in a&&(a=a.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(a))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:a,duration:s||this.duration})},i.prototype.compile=function(a){var s=function e(a){var s=URL.createObjectURL(new Blob([a.toString(),"this.onmessage =  function (eee) {"+a.name+"(eee.data);}"],{type:"application/javascript"})),n=new Worker(s);return URL.revokeObjectURL(s),n}(t);s.onmessage=function(n){n.data.error?console.error(n.data.error):a(n.data)},s.postMessage(this.frames)},{Video:i}}();typeof RecordRTC<"u"&&(RecordRTC.Whammy=Whammy);var DiskStorage={init:function(){var i=this;if(typeof indexedDB>"u"||typeof indexedDB.open>"u")console.error("IndexedDB API are not available in this browser.");else{var a,t=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),s=indexedDB.open(t,1);s.onerror=i.onError,s.onsuccess=function(){(a=s.result).onerror=i.onError,a.setVersion&&1!==a.version?a.setVersion(1).onsuccess=function(){n(a),c()}:c()},s.onupgradeneeded=function(r){n(r.target.result)}}function n(r){r.createObjectStore(i.dataStoreName)}function c(){var r=a.transaction([i.dataStoreName],"readwrite");function p(R){r.objectStore(i.dataStoreName).get(R).onsuccess=function(l){i.callback&&i.callback(l.target.result,R)}}i.videoBlob&&r.objectStore(i.dataStoreName).put(i.videoBlob,"videoBlob"),i.gifBlob&&r.objectStore(i.dataStoreName).put(i.gifBlob,"gifBlob"),i.audioBlob&&r.objectStore(i.dataStoreName).put(i.audioBlob,"audioBlob"),p("audioBlob"),p("videoBlob"),p("gifBlob")}},Fetch:function(i){return this.callback=i,this.init(),this},Store:function(i){return this.audioBlob=i.audioBlob,this.videoBlob=i.videoBlob,this.gifBlob=i.gifBlob,this.init(),this},onError:function(i){console.error(JSON.stringify(i,null,"\t"))},dataStoreName:"recordRTC",dbName:null};function GifRecorder(i,e){if(typeof GIFEncoder>"u"){var t=document.createElement("script");t.src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(t)}e=e||{};var a=i instanceof CanvasRenderingContext2D||i instanceof HTMLCanvasElement;this.record=function(){typeof GIFEncoder>"u"?setTimeout(S.record,1e3):p?(a||(e.width||(e.width=R.offsetWidth||320),e.height||(e.height=R.offsetHeight||240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),c.width=e.canvas.width||320,c.height=e.canvas.height||240,R.width=e.video.width||320,R.height=e.video.height||240),(f=new GIFEncoder).setRepeat(0),f.setDelay(e.frameRate||200),f.setQuality(e.quality||10),f.start(),"function"==typeof e.onGifRecordingStarted&&e.onGifRecordingStarted(),Date.now(),l=requestAnimationFrame(function C(h){if(!0!==S.clearedRecordedData){if(s)return setTimeout(function(){C(h)},100);l=requestAnimationFrame(C),void 0===typeof m&&(m=h),!(h-m<90)&&(!a&&R.paused&&R.play(),a||r.drawImage(R,0,0,c.width,c.height),e.onGifPreview&&e.onGifPreview(c.toDataURL("image/png")),f.addFrame(r),m=h)}}),e.initCallback&&e.initCallback()):setTimeout(S.record,1e3)},this.stop=function(C){C=C||function(){},l&&cancelAnimationFrame(l),Date.now(),this.blob=new Blob([new Uint8Array(f.stream().bin)],{type:"image/gif"}),C(this.blob),f.stream().bin=[]};var s=!1;this.pause=function(){s=!0},this.resume=function(){s=!1},this.clearRecordedData=function(){S.clearedRecordedData=!0,function n(){f&&(f.stream().bin=[])}()},this.name="GifRecorder",this.toString=function(){return this.name};var c=document.createElement("canvas"),r=c.getContext("2d");a&&(i instanceof CanvasRenderingContext2D?c=(r=i).canvas:i instanceof HTMLCanvasElement&&(r=i.getContext("2d"),c=i));var p=!0;if(!a){var R=document.createElement("video");R.muted=!0,R.autoplay=!0,R.playsInline=!0,p=!1,R.onloadedmetadata=function(){p=!0},setSrcObject(i,R),R.play()}var m,f,l=null,S=this}function MultiStreamsMixer(i,e){var o;o=typeof global<"u"?global:null,typeof RecordRTC<"u"||o&&(typeof window<"u"||typeof global>"u"||(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},global.console||(global.console={}),(typeof global.console.log>"u"||typeof global.console.error>"u")&&(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),typeof document>"u"&&(o.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var d={getContext:function(){return d},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return d},o.HTMLVideoElement=function(){}),typeof location>"u"&&(o.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(o.screen={width:0,height:0}),typeof R>"u"&&(o.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),o.window=global)),e=e||"multi-streams-mixer";var a=[],s=!1,n=document.createElement("canvas"),c=n.getContext("2d");n.style.opacity=0,n.style.position="absolute",n.style.zIndex=-1,n.style.top="-1000em",n.style.left="-1000em",n.className=e,(document.body||document.documentElement).appendChild(n),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var r=this,p=window.AudioContext;typeof p>"u"&&(typeof webkitAudioContext<"u"&&(p=webkitAudioContext),typeof mozAudioContext<"u"&&(p=mozAudioContext));var R=window.URL;typeof R>"u"&&typeof webkitURL<"u"&&(R=webkitURL),typeof navigator<"u"&&typeof navigator.getUserMedia>"u"&&(typeof navigator.webkitGetUserMedia<"u"&&(navigator.getUserMedia=navigator.webkitGetUserMedia),typeof navigator.mozGetUserMedia<"u"&&(navigator.getUserMedia=navigator.mozGetUserMedia));var l=window.MediaStream;typeof l>"u"&&typeof webkitMediaStream<"u"&&(l=webkitMediaStream),typeof l<"u"&&typeof l.prototype.stop>"u"&&(l.prototype.stop=function(){this.getTracks().forEach(function(o){o.stop()})});var b={};function m(){if(!s){var o=a.length,d=!1,w=[];if(a.forEach(function(k){k.stream||(k.stream={}),k.stream.fullcanvas?d=k:w.push(k)}),d)n.width=d.stream.width,n.height=d.stream.height;else if(w.length){n.width=o>1?2*w[0].width:w[0].width;var y=1;(3===o||4===o)&&(y=2),(5===o||6===o)&&(y=3),(7===o||8===o)&&(y=4),(9===o||10===o)&&(y=5),n.height=w[0].height*y}else n.width=r.width||360,n.height=r.height||240;d&&d instanceof HTMLVideoElement&&f(d),w.forEach(function(k,T){f(k,T)}),setTimeout(m,r.frameInterval)}}function f(o,d){if(!s){var w=0,y=0,k=o.width,T=o.height;1===d&&(w=o.width),2===d&&(y=o.height),3===d&&(w=o.width,y=o.height),4===d&&(y=2*o.height),5===d&&(w=o.width,y=2*o.height),6===d&&(y=3*o.height),7===d&&(w=o.width,y=3*o.height),typeof o.stream.left<"u"&&(w=o.stream.left),typeof o.stream.top<"u"&&(y=o.stream.top),typeof o.stream.width<"u"&&(k=o.stream.width),typeof o.stream.height<"u"&&(T=o.stream.height),c.drawImage(o,w,y,k,T),"function"==typeof o.stream.onRender&&o.stream.onRender(c,w,y,k,T,d)}}function u(o){var d=document.createElement("video");return function g(o,d){"srcObject"in d?d.srcObject=o:"mozSrcObject"in d?d.mozSrcObject=o:d.srcObject=o}(o,d),d.className=e,d.muted=!0,d.volume=0,d.width=o.width||r.width||360,d.height=o.height||r.height||240,d.play(),d}function v(o){a=[],(o=o||i).forEach(function(d){if(d.getTracks().filter(function(y){return"video"===y.kind}).length){var w=u(d);w.stream=d,a.push(w)}})}typeof p<"u"?b.AudioContext=p:typeof webkitAudioContext<"u"&&(b.AudioContext=webkitAudioContext),this.startDrawingFrames=function(){m()},this.appendStreams=function(o){if(!o)throw"First parameter is required.";o instanceof Array||(o=[o]),o.forEach(function(d){var w=new l;if(d.getTracks().filter(function(T){return"video"===T.kind}).length){var y=u(d);y.stream=d,a.push(y),w.addTrack(d.getTracks().filter(function(T){return"video"===T.kind})[0])}if(d.getTracks().filter(function(T){return"audio"===T.kind}).length){var k=r.audioContext.createMediaStreamSource(d);r.audioDestination=r.audioContext.createMediaStreamDestination(),k.connect(r.audioDestination),w.addTrack(r.audioDestination.stream.getTracks().filter(function(T){return"audio"===T.kind})[0])}i.push(w)})},this.releaseStreams=function(){a=[],s=!0,r.gainNode&&(r.gainNode.disconnect(),r.gainNode=null),r.audioSources.length&&(r.audioSources.forEach(function(o){o.disconnect()}),r.audioSources=[]),r.audioDestination&&(r.audioDestination.disconnect(),r.audioDestination=null),r.audioContext&&r.audioContext.close(),r.audioContext=null,c.clearRect(0,0,n.width,n.height),n.stream&&(n.stream.stop(),n.stream=null)},this.resetVideoStreams=function(o){o&&!(o instanceof Array)&&(o=[o]),v(o)},this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=function S(){s=!1;var o=function C(){var o;v(),"captureStream"in n?o=n.captureStream():"mozCaptureStream"in n?o=n.mozCaptureStream():r.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var d=new l;return o.getTracks().filter(function(w){return"video"===w.kind}).forEach(function(w){d.addTrack(w)}),n.stream=d,d}(),d=function h(){b.AudioContextConstructor||(b.AudioContextConstructor=new b.AudioContext),r.audioContext=b.AudioContextConstructor,r.audioSources=[],!0===r.useGainNode&&(r.gainNode=r.audioContext.createGain(),r.gainNode.connect(r.audioContext.destination),r.gainNode.gain.value=0);var o=0;if(i.forEach(function(d){if(d.getTracks().filter(function(y){return"audio"===y.kind}).length){o++;var w=r.audioContext.createMediaStreamSource(d);!0===r.useGainNode&&w.connect(r.gainNode),r.audioSources.push(w)}}),o)return r.audioDestination=r.audioContext.createMediaStreamDestination(),r.audioSources.forEach(function(d){d.connect(r.audioDestination)}),r.audioDestination.stream}();return d&&d.getTracks().filter(function(y){return"audio"===y.kind}).forEach(function(y){o.addTrack(y)}),i.forEach(function(y){}),o}}function MultiStreamRecorder(i,e){i=i||[];var a,s,t=this;(e=e||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}}).frameInterval||(e.frameInterval=10),e.video||(e.video={}),e.video.width||(e.video.width=360),e.video.height||(e.video.height=240),this.record=function(){a=new MultiStreamsMixer(i,e.elementClass||"multi-streams-mixer"),function n(){var c=[];return i.forEach(function(r){getTracks(r,"video").forEach(function(p){c.push(p)})}),c}().length&&(a.frameInterval=e.frameInterval||10,a.width=e.video.width||360,a.height=e.video.height||240,a.startDrawingFrames()),e.previewStream&&"function"==typeof e.previewStream&&e.previewStream(a.getMixedStream()),(s=new MediaStreamRecorder(a.getMixedStream(),e)).record()},this.stop=function(c){s&&s.stop(function(r){t.blob=r,c(r),t.clearRecordedData()})},this.pause=function(){s&&s.pause()},this.resume=function(){s&&s.resume()},this.clearRecordedData=function(){s&&(s.clearRecordedData(),s=null),a&&(a.releaseStreams(),a=null)},this.addStreams=function(c){if(!c)throw"First parameter is required.";c instanceof Array||(c=[c]),i.concat(c),s&&a&&(a.appendStreams(c),e.previewStream&&"function"==typeof e.previewStream&&e.previewStream(a.getMixedStream()))},this.resetVideoStreams=function(c){a&&(c&&!(c instanceof Array)&&(c=[c]),a.resetVideoStreams(c))},this.getMixer=function(){return a},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}function RecordRTCPromisesHandler(i,e){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(typeof i>"u")throw'First argument "MediaStream" is required.';var t=this;t.recordRTC=new RecordRTC(i,e),this.startRecording=function(){return new Promise(function(a,s){try{t.recordRTC.startRecording(),a()}catch(n){s(n)}})},this.stopRecording=function(){return new Promise(function(a,s){try{t.recordRTC.stopRecording(function(n){t.blob=t.recordRTC.getBlob(),t.blob&&t.blob.size?a(n):s("Empty blob.",t.blob)})}catch(n){s(n)}})},this.pauseRecording=function(){return new Promise(function(a,s){try{t.recordRTC.pauseRecording(),a()}catch(n){s(n)}})},this.resumeRecording=function(){return new Promise(function(a,s){try{t.recordRTC.resumeRecording(),a()}catch(n){s(n)}})},this.getDataURL=function(a){return new Promise(function(s,n){try{t.recordRTC.getDataURL(function(c){s(c)})}catch(c){n(c)}})},this.getBlob=function(){return new Promise(function(a,s){try{a(t.recordRTC.getBlob())}catch(n){s(n)}})},this.getInternalRecorder=function(){return new Promise(function(a,s){try{a(t.recordRTC.getInternalRecorder())}catch(n){s(n)}})},this.reset=function(){return new Promise(function(a,s){try{a(t.recordRTC.reset())}catch(n){s(n)}})},this.destroy=function(){return new Promise(function(a,s){try{a(t.recordRTC.destroy())}catch(n){s(n)}})},this.getState=function(){return new Promise(function(a,s){try{a(t.recordRTC.getState())}catch(n){s(n)}})},this.blob=null,this.version="5.6.2"}function WebAssemblyRecorder(i,e){var a,n,r;function c(l,b){if(!e.workerPath&&!b)return a=!1,void fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then(function(m){m.arrayBuffer().then(function(f){c(l,f)})});if(!e.workerPath&&b instanceof ArrayBuffer){var g=new Blob([b],{type:"text/javascript"});e.workerPath=URL.createObjectURL(g)}e.workerPath||console.error("workerPath parameter is missing."),(n=new Worker(e.workerPath)).postMessage(e.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),n.addEventListener("message",function(m){"READY"===m.data?(n.postMessage({width:e.width,height:e.height,bitrate:e.bitrate||1200,timebaseDen:e.frameRate||30,realtime:e.realtime}),function s(){return new ReadableStream({start:function(l){var b=document.createElement("canvas"),g=document.createElement("video"),m=!0;g.srcObject=i,g.muted=!0,g.height=e.height,g.width=e.width,g.volume=0,g.onplaying=function(){b.width=e.width,b.height=e.height;var f=b.getContext("2d"),C=setInterval(function(){if(a&&(clearInterval(C),l.close()),m&&(m=!1,e.onVideoProcessStarted&&e.onVideoProcessStarted()),f.drawImage(g,0,0),"closed"!==l._controlledReadableStream.state)try{l.enqueue(f.getImageData(0,0,e.width,e.height))}catch{}},1e3/e.frameRate)},g.play()}})}().pipeTo(new WritableStream({write:function(f){a?console.error("Got image, but recorder is finished!"):n.postMessage(f.data.buffer,[f.data.buffer])}}))):m.data&&(r||R.push(m.data))})}(typeof ReadableStream>"u"||typeof WritableStream>"u")&&console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),(e=e||{}).width=e.width||640,e.height=e.height||480,e.frameRate=e.frameRate||30,e.bitrate=e.bitrate||1200,e.realtime=e.realtime||!0,this.record=function(){R=[],r=!1,this.blob=null,c(i),"function"==typeof e.initCallback&&e.initCallback()},this.pause=function(){r=!0},this.resume=function(){r=!1};var R=[];this.stop=function(l){a=!0;var b=this;!function p(l){n?(n.addEventListener("message",function(b){null===b.data&&(n.terminate(),n=null,l&&l())}),n.postMessage(null)):l&&l()}(function(){b.blob=new Blob(R,{type:"video/webm"}),l(b.blob)})},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){R=[],r=!1,this.blob=null},this.blob=null}typeof RecordRTC<"u"&&(RecordRTC.DiskStorage=DiskStorage),typeof RecordRTC<"u"&&(RecordRTC.GifRecorder=GifRecorder),typeof RecordRTC>"u"&&(typeof module<"u"&&(module.exports=MultiStreamsMixer),"function"==typeof define&&define.amd&&define("MultiStreamsMixer",[],function(){return MultiStreamsMixer})),typeof RecordRTC<"u"&&(RecordRTC.MultiStreamRecorder=MultiStreamRecorder),typeof RecordRTC<"u"&&(RecordRTC.RecordRTCPromisesHandler=RecordRTCPromisesHandler),typeof RecordRTC<"u"&&(RecordRTC.WebAssemblyRecorder=WebAssemblyRecorder);